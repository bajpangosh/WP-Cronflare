# Changelog

All notable changes to the Single-Site version of this Worker are recorded here.

---

## [2.0.0] — 2025-02-19

### Breaking changes

- **Renamed environment variable** `DEFAULT_DOMAIN` → `WP_CRON_URL`.  
  The value also changes: previously it held only the hostname (e.g. `example.com`); it must now be the full base URL including the scheme (e.g. `https://example.com`). Update both the variable name and value in your Worker's **Settings → Variables and Secrets**.

- **Renamed environment variable** `WORKER_SECRET_KEY` → `WP_CRON_KEY`.  
  The value is unchanged — update only the name. This aligns the naming convention with the Multi-Site version (`WP_CRON_SITES`), making it easier to manage both Workers in the same Cloudflare account.

### Bug fixes

- **Missing variable guard.** If `WP_CRON_URL` or `WP_CRON_KEY` were not set, the Worker would crash with an unhelpful runtime error. The Worker now checks for both variables before attempting a fetch and returns a clear error message explaining which variable is missing.

### Improvements

- **Request timeout.** The fetch to `wp-cron.php` now has a 10-second timeout via `AbortController`. A slow or unresponsive WordPress server will no longer hang the Worker indefinitely. Timeouts are logged and return HTTP 504.

- **Confirmation message updated.** The browser confirmation message returned by the `fetch()` handler is now:  
  `Cloudflare Worker for WordPress works. Yay!`  
  Previously: `Cron executed successfully. Yay!`

- **Error details in logs.** When WordPress returns a non-OK HTTP status, the Worker now reads and logs up to 500 characters of the response body, making it easier to diagnose server-side errors without leaving the Cloudflare dashboard.

- **Consistent URL handling.** `WP_CRON_URL` now accepts the full site URL (e.g. `https://example.com`). Trailing slashes are stripped automatically, so both `https://example.com` and `https://example.com/` work correctly.

- **Code comments.** All functions are fully documented with inline comments explaining what each section does and why.

### README

- Rewrote all sections for clarity. Plain English throughout, with no assumed knowledge of Cloudflare internals.
- Added a **Single-Site vs Multi-Site** comparison table.
- **Step 3 (Worker Route):** Now fully explains what route pattern to enter (`your-site.com/wp-cron.php*`) and why the `*` wildcard is needed.
- **Step 4 (WAF skip rule):** Now includes the actual WAF expression that was missing entirely from the original README. Marked as optional for users not using Cloudflare WAF.
- **Step 5 (Cron Trigger):** Now shows the actual cron expression (`* * * * *`).
- **Step 6 (wp-config.php):** Fixed broken code block (missing closing fence in original).
- **Step 7 (Testing):** Now explains exactly what the browser confirmation message means, how it is generated by the Worker, and what to check if you see your normal site instead.
- **Securing wp-cron.php:** Updated Apache configuration from the deprecated Apache 2.2 `Order Deny,Allow` syntax to the current Apache 2.4 `Require` directive.
- Added a Notes and limitations section.
